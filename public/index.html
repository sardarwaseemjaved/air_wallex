<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Airwallex Hosted Checkout</title>
    <script src="https://checkout.airwallex.com/assets/elements.bundle.min.js"></script>
  </head>
  <body>
    <h1>Airwallex Hosted Checkout Demo</h1>
    <button id="checkout-btn">Pay $19.99</button>

    <script type="module">
      import { init } from "https://checkout.airwallex.com/assets/elements.es.min.js";

      const backendBaseUrl = "air-wallex.vercel.app";

      document.getElementById("checkout-btn").addEventListener("click", async () => {
        try {
          // 1. Call backend to create PaymentIntent
          const res = await fetch(`${backendBaseUrl}/api/create-payment-intent`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ amount: 1999, currency: "USD" }),
          });

          const { intent_id, client_secret } = await res.json();

          // 2. Init Airwallex
          const { payments } = await init({
            env: "demo", // use "prod" for live
            enabledElements: ["payments"],
          });

          // 3. Redirect to Hosted Payment Page
          await payments.redirectToCheckout({
            intent_id,
            client_secret,
            currency: "USD",
            country_code: "US",
            successUrl: `${backendBaseUrl}/success.html`,
            failUrl: `${backendBaseUrl}/fail.html`,
          });
        } catch (err) {
          console.error("Checkout error:", err);
          alert("Something went wrong. Please try again.");
        }
      });
    </script>
  </body>
</html>
